<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>Înregistrare Cheltuială</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        // Toggle new-product inputs depending on whether an existing product is selected
        function toggleNewProductFields() {
            const prodSelect = document.getElementById('product_id');
            const newFields = document.getElementById('new-product-fields');
            const prodName = document.getElementById('product_name');
            const catSelect = document.getElementById('category_id');
            if (!prodSelect || !newFields) return;
            if (prodSelect.value && prodSelect.value !== '') {
                newFields.style.display = 'none';
                // Clear new product inputs to avoid accidental submission
                if (prodName) prodName.value = '';
                if (catSelect) catSelect.selectedIndex = 0;
            } else {
                newFields.style.display = 'block';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const prodSelect = document.getElementById('product_id');
            if (prodSelect) {
                prodSelect.addEventListener('change', toggleNewProductFields);
            }
            // Initialize on load
            toggleNewProductFields();
        });
    </script>
</head>
<body>
    <div class="navbar">
        <a href="/">Acasă</a>
        <a href="/cheltuieli">Cheltuieli</a>
        <a href="/reports">Rapoarte</a>
        <a href="/reports/monthly">Rapoarte lunare</a>
        <a href="/reports/products">Rapoarte pe produse</a>
        <a href="/reports/stores">Rapoarte pe magazine</a>
    </div>
    <div class="container">
        <h1>Înregistrare cheltuială</h1>

        <section class="section">
            <h2>Adaugă cheltuială</h2>
            <form method="POST" action="/add_expense">
                <label for="product_id">Alege produs existent (sau lasă gol pentru un produs nou)</label>
                <select name="product_id" id="product_id">
                    <option value="" selected>Alege produsul</option>
                    {% for p in products %}
                        <option value="{{ p[0] }}">{{ p[1] }}{% if p[2] %} — {{ p[2] }}{% endif %}</option>
                    {% endfor %}
                </select>

                <p>SAU</p>
                <div id="new-product-fields">
                    <input type="text" id="product_name" name="product_name" placeholder="Nume produs nou (ex: 'Ciocolata')">

                    <label for="category_id">Categoria (pentru produs nou)</label>
                    <select name="category_id" id="category_id">
                    <option value="" selected>Alege categoria</option>
                    {% for cat in categories %}
                        <option value="{{ cat[0] }}">{{ cat[1] }}</option>
                    {% endfor %}
                    </select>
                </div>

                <label for="store_id">Magazin</label>
                <select name="store_id" id="store_id" required>
                    <option value="" disabled selected>Alege magazinul</option>
                    {% for s in stores %}
                        <option value="{{ s[0] }}">{{ s[1] }}</option>
                    {% endfor %}
                </select>

                <p>
                    Dacă magazinul nu este în listă, <a href="/stores/new">adaugă magazin nou</a>.
                </p>

                <input type="number" step="0.01" name="price" placeholder="Preț" required>
                <input type="number" step="0.01" name="quantity" placeholder="Cantitate" required>
                <input type="date" name="date" required>
                <button type="submit">Adaugă cheltuială</button>
            </form>
        </section>

        <a href="/">⬅️ Înapoi</a>
    </div>
</body>
</html>
