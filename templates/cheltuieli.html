<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>Cheltuieli</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="navbar">
        <a href="/">Acasă</a>
        <a href="/cheltuieli">Cheltuieli</a>
        <a href="/reports">Rapoarte</a>
        <a href="/reports/monthly">Rapoarte lunare</a>
        <a href="/reports/products">Rapoarte pe produse</a>
        <a href="/reports/stores">Rapoarte pe magazine</a>
    </div>
    <div class="container">
        <h1>Cheltuieli (grupate pe bonuri)</h1>

        <section class="section">
            <p><a href="/record_expense" class="btn">Adaugă bon</a></p>

            {% if receipts %}
                {% for r in receipts %}
                    <div style="border:1px solid #ddd; padding:12px; margin-bottom:12px; border-radius:8px;">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <strong>Bon #{{ r.nr_bon }}</strong>
                                {% if r.nr_bon %} — Nr: {{ r.nr_bon }}{% endif %}
                                <div style="color:#555">Magazin: {{ r.store_name or '—' }} | Data: {{ r.date or '—' }}</div>
                            </div>
                            <div>
                                <a class="btn" href="#" onclick="return false;">Export</a>
                            </div>
                        </div>
                        <table style="margin-top:8px;">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Produs</th>
                                    <th>Preț</th>
                                    <th>Cantitate</th>
                                    <th>Unitate</th>
                                    <th>Discount (lei)</th>
                                    <th>Total (lei)</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for line in r.lines %}
                                        <tr>
                                            <td>{{ line[0] }}</td>
                                            <td>{{ line[1] }}</td>
                                            <td>{{ '%.2f'|format(line[2] or 0) }}</td>
                                            <td>{{ '%.2f'|format(line[3] or 0) }}</td>
                                            <td>{{ line[6] or 'buc' }}</td>
                                            <td>{{ '%.2f'|format(line[4] or 0) }}</td>
                                            <td>{{ '%.2f'|format(line[5] or 0) }}</td>
                                        </tr>
                                {% else %}
                                    <tr><td colspan="7">Nicio linie înregistrată</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% endfor %}
            {% else %}
                <p>Nu există bonuri înregistrate.</p>
            {% endif %}

            {% if ungrouped and ungrouped|length > 0 %}
                <h2>Articole fără bon</h2>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Produs</th>
                            <th>Magazin</th>
                            <th>Preț</th>
                            <th>Cantitate</th>
                            <th>Discount (lei)</th>
                            <th>Total (lei)</th>
                            <th>Data</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for e in ungrouped %}
                            <tr>
                                <td>{{ e[0] }}</td>
                                <td>{{ e[1] }}</td>
                                <td>{{ e[2] }}</td>
                                <td>{{ '%.2f'|format(e[3] or 0) }}</td>
                                <td>{{ '%.2f'|format(e[4] or 0) }}</td>
                                <td>{{ '%.2f'|format(e[5] or 0) }}</td>
                                <td>{{ '%.2f'|format(e[6] or 0) }}</td>
                                <td>{{ e[7] }}</td>
                            </tr>
                        {% else %}
                            <tr><td colspan="8">Nicio cheltuială fără bon</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% endif %}
        </section>

        <a href="/">⬅️ Înapoi</a>
    </div>
</body>
</html>
